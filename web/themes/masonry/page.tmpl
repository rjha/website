<?php
    require_once ('wb-app.inc');
    require_once (APP_WEB_DIR.'/inc/header.inc');

    use \com\indigloo\Url as Url ;
    use \com\indigloo\util\StringUtil as StringUtil ;
    use \com\indigloo\wb\Constants as AppConstants;

    // get site_id injected in request
    $gWeb = \com\indigloo\core\Web::getInstance();
    $gSiteView = $gWeb->getRequestAttribute(AppConstants::SITE_SESSION_VIEW);
    $siteId = $gSiteView->id ;

    $seo_title = $router_params["token"];
    $pageDao = new \com\indigloo\wb\dao\Page();
    $pageDBRow = $pageDao->getOnSeoTitle($siteId,$seo_title);
    $gPageId = $pageDBRow["id"];


    $gMenuPosts = $pageDao->getRandomPosts($siteId,7);
    $postDBRows = $pageDao->getPostsOnId($siteId,$gPageId);
    $gNumPosts = sizeof($postDBRows);

   
    //@todo - read from DB
    $gMetaKeywords = "shoes converse shoes vans shoes knee high reef sandal";
    $gMetaDescription = StringUtil::convertKeyToName($seo_title);
    $gSelfUrl = Url::base().$router_options["path"];
    

?>

<!DOCTYPE html>
<html>

    <head>
        <title> <?php echo $pageDBRow["title"] ?> </title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="keywords" content="">
        <meta name="description" content="">

         
        <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <?php echo \com\indigloo\wb\util\Asset::version("/css/wb-bundle.css"); ?>


    </head>

     <body>
        
        <?php include("page-header.inc") ?>
        
        <div class="container">

            <div class="row">
                <div class="span11 offset1" style="border-bottom:1px solid #d5d5d5;padding-bottom:10px;padding-top:20px">
                    <!-- AddThis Button BEGIN -->
                    <div class="addthis_toolbox addthis_default_style ">
                        <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
                        <a class="addthis_button_tweet"></a>
                        <a class="addthis_button_pinterest_pinit"></a>
                        <a class="addthis_counter addthis_pill_style"></a>
                    </div>

                    <script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
                    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4e57380d63c7f2a1"></script>
                    <!-- AddThis Button END -->
                </div>

            </div> <!-- row:addthis -->

            <div class="row">
                <div class="span7 offset1">
                    
                    <div id="page-content">

                       <?php
                            foreach($postDBRows as $postDBRow) {
                                $html = \com\indigloo\wb\html\Application::getPost($postDBRow);
                                echo $html ;
                            }
                        ?>
                    </div>

                    <!-- FB comments -->
                    <div class="fb-comments pt20" data-href="<?php echo $gSelfUrl; ?>" data-width="600" data-num-posts="10"></div>

                </div>
                <div class="span3 offset1">
                    <?php
                        foreach($gMenuPosts as $gMenuPost) {
                           $html = \com\indigloo\wb\html\Application::getPostTile($gMenuPost);
                           echo $html ;
                        }
                    ?>
                    <div class="p20">
                        <a href="/sitemap">View all Posts &gt;</a>
                    </div>
                    
                </div>

            </div> <!-- row:content -->

        </div>   <!-- container -->

       


    </body>
</html>